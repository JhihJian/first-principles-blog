name: Build & Deploy
on:
  push:
    branches: [main]
  repository_dispatch:
    types: [content-update]

jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        # ... 检出代码、拉取内容、构建 ...
        - run: npm ci
        - run: npm run build
        - uses: actions/upload-artifact@v4  # 保存构建产物
          with:
            name: dist
            path: dist/

    deploy-github-pages:
      needs: build
      runs-on: ubuntu-latest
      permissions:
        pages: write
        id-token: write
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      steps:
        - uses: actions/download-artifact@v4
          with:
            name: dist
            path: dist/
        - uses: actions/upload-pages-artifact@v3
          with:
            path: dist/
        - id: deployment
          uses: actions/deploy-pages@v4

